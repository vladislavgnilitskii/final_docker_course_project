# Final Docker Course Project

## Задание: Контейнеризация CRM приложения

Код приложения лежит в этом репозитории: [docker\_final\_project](https://github.com/prostodevops/docker_final_project/tree/master)

Склонируйте репозиторий и выполните задание:

```bash
git clone https://github.com/prostodevops/docker_final_project.git
```

---

## О приложении

Веб-приложение для управления базой клиентов, состоящее из трёх компонентов:

* **Frontend:** React + TypeScript
* **Backend:** Node.js + Express
* **Database:** PostgreSQL

Необходимо полностью контейнеризировать приложение с использованием Docker и Docker Compose.

---

## Требования

### 1. Dockerfile для каждого компонента

#### Backend (`backend/Dockerfile`)

* Использовать multi-stage build для оптимизации размера образа
* Базироваться на Alpine-образе
* Запускать приложение от непривилегированного пользователя
* Правильно настроить рабочую директорию и копирование файлов
* Использовать кеширование слоёв Docker для ускорения сборки

#### Frontend (`frontend/Dockerfile`)

* Использовать multi-stage build (deps, builder, runner)
* Этап сборки: Node.js для компиляции React приложения
* Финальный образ: `nginx:alpine` для раздачи статики
* Настроить проксирование API-запросов к backend
* Оптимизировать размер финального образа

#### Database (`database/Dockerfile`)

* Использовать базовый образ PostgreSQL (alpine)
* Автоматическая инициализация БД через `init.sql`
* Настроить права доступа для скриптов инициализации

---

### 2. Docker Compose конфигурация

Файл `docker-compose.yml` должен содержать следующие элементы:

#### Сервисы

* **database**: контейнер PostgreSQL с инициализацией БД
* **backend**: Node.js API сервер
* **frontend**: Nginx сервер для React приложения

#### Сети

* `backend_network`: изолированная сеть для связи backend ↔ database
* `frontend_network`: сеть для связи frontend ↔ backend
* Frontend **не должен** иметь прямого доступа к database
* Backend должен иметь доступ к обеим сетям

#### Volumes

* Именованный volume для PostgreSQL (`postgres_data`)
* Обеспечение персистентности данных БД между перезапусками

#### Переменные окружения

* Все чувствительные данные вынесены в `.env`
* Поддержка переопределения портов через переменные
* Конфигурация подключения к БД через переменные окружения

#### Health checks

* Проверка готовности PostgreSQL перед запуском backend
* Задать правильную последовательность запуска (`depends_on`)

---

### 3. Файл переменных окружения (`.env`)

Должен содержать:

* параметры подключения к БД (пользователь, пароль, имя БД)
* порты для всех сервисов
* режим работы приложения (`NODE_ENV`)

---

### 4. Дополнительные требования

* Создать `.dockerignore` для исключения ненужных файлов из контекста сборки
* Обновить `backend/server.js` для использования переменных окружения
* Все контейнеры должны автоматически перезапускаться при сбое

---

## Проверка выполнения

### Запуск приложения

Приложение должно запускаться одной командой:

```bash
docker-compose up --build
```

### Доступность сервисов

* Frontend: [http://localhost](http://localhost) (порт 80 по умолчанию)
* Backend API: [http://localhost:3001](http://localhost:3001)
* PostgreSQL: `localhost:5432` (для отладки)

### Функциональность

* Открыть веб-интерфейс в браузере
* Проверить отображение списка клиентов
* Добавить нового клиента через форму
* Убедиться, что данные сохраняются в БД
* Перезапустить контейнеры и проверить сохранность данных

### Изоляция сетей

* Frontend контейнер не должен иметь доступ к database напрямую
* Backend должен подключаться к database
* Frontend должен проксировать API-запросы к backend

---

## Критерии оценки

* **Корректность работы:** приложение запускается и работает без ошибок
* **Best Practices:** multi-stage builds, непривилегированные пользователи, оптимизация размеров
* **Безопасность:** изоляция сетей, переменные окружения для секретов
* **Оптимизация:** кеширование Docker, минимальный размер образов
* **Документация:** комментарии в конфигурационных файлах

---

## Что сдавать?

Архив проекта или ссылку на git-репозиторий, содержащий:

* исходные файлы приложения
* `Dockerfile` для каждого компонента
* `docker-compose.yml`
* `.env`
* `.dockerignore`
* файл `TASK.md` с описанием задания

---

## Дополнительные задания (опционально)

* Настроить SSL/TLS для frontend (самоподписанный сертификат)
* Добавить контейнер для резервного копирования БД
* Настроить логирование в отдельные volumes
